<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de RH ‚Äì Evaluaci√≥n de Sesiones</title>

  <!-- Tipograf√≠as corporativas -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ---------- PALETA Y VARIABLES ---------- */
    :root{
      --primary-dark:#0c0e2c;      /* azul Alfasigma */
      --primary-mid:#003559;
      --primary-light:#00bfff;     /* cian */
      --secondary-red:#cc0000;
      --text-dark:#222;
      --text-light:#e6e8ef;
      --bg-gray:#f4f6fa;
      --bg-white:#ffffff;
      --border:#e0e0e0;
      --shadow-lg:rgba(0,0,0,.3);
      --shadow-sm:rgba(0,0,0,.05);
    }

    /* ---------- RESET ---------- */
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      font-family:'Open Sans',sans-serif;
      line-height:1.55;
      background:var(--primary-dark);
      color:var(--text-light);
    }
    a{color:var(--primary-light);text-decoration:none}

    /* ---------- HEADER ---------- */
    header{
      display:flex;align-items:center;gap:16px;
      padding:16px 32px;
      background:linear-gradient(90deg,var(--primary-dark) 0%,var(--primary-mid) 50%,var(--primary-light) 100%);
      box-shadow:0 2px 6px rgba(0,0,0,.45);
    }
    header img{height:48px}
    header h1{
      font-family:'Montserrat',sans-serif;
      font-weight:700;
      font-size:28px;
      color:#fff;
    }

    /* ---------- LAYOUT ---------- */
    .container{max-width:1200px;margin:0 auto;padding:40px 32px}

    .section-title{
      font:600 24px 'Montserrat',sans-serif;
      margin:40px 0 24px;
      border-bottom:2px solid var(--primary-light);
      padding-bottom:10px;
    }

    /* ---------- SESSION ENTRY ---------- */
    .session-entry{
      background:var(--bg-white);
      color:var(--text-dark);
      border-radius:16px;
      box-shadow:0 8px 24px var(--shadow-lg);
      padding:24px;
      margin-bottom:40px;
      display:grid;
      grid-template-columns:1fr;
      gap:24px;
    }
    @media (min-width:1024px){
      .session-entry{grid-template-columns:1fr 380px}
    }
    .session-entry h3{
      font:600 20px 'Montserrat',sans-serif;
      color:var(--primary-dark);
      margin-bottom:12px;
      border-bottom:1px solid #eee;
      padding-bottom:8px;
    }
    .session-info strong{color:#555}

    /* ---------- VIDEO ---------- */
    video{
      width:100%;
      border:1px solid var(--primary-light);
      border-radius:12px;
      object-fit:cover;
      box-shadow:0 4px 10px rgba(0,0,0,.15);
    }

    /* ---------- CHAT ---------- */
    .chat-log ul{list-style:none;padding:0;margin:0}
    .chat-log li{display:flex;margin-bottom:12px}
    .bubble{
      padding:10px 14px;
      border-radius:12px;
      font-size:15px;
      max-width:100%;
    }
    .user   .bubble{background:rgba(128,90,213,.15);border-left:6px solid #805ad5}
    .doctor .bubble{background:rgba(0,191,255,.15);border-left:6px solid var(--primary-light)}

    /* ---------- EVALUACIONES ---------- */
    .evaluation{margin-top:20px;padding:15px;border-radius:8px;background:#e0f7fa;border-left:5px solid #0099cc;color:var(--text-dark)}
    .evaluation.rh{background:#ffeeee;border-left-color:var(--secondary-red)}
    .evaluation.rh h4{color:var(--secondary-red);margin:15px 0 5px;font:600 1em 'Montserrat'}
    .metric-line{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px dashed #f0c0c0;font-size:.95em}
    .metric-line:last-child{border-bottom:none;}

    /* ---------- TABLAS ---------- */
    table{width:100%;border-collapse:collapse;margin-top:20px}
    th,td{padding:12px 8px;font-size:14px}
    th{background:#f8f8f8;color:var(--primary-dark);font:600 .8rem 'Montserrat';text-transform:uppercase}
    tr:nth-child(even){background:#fdfdfd}
    tr:hover{background:#f0f8ff}

    /* ---------- PROGRESS ---------- */
    .progress-bar{background:#e9ecef;border-radius:8px;overflow:hidden;height:25px;margin-top:15px;border:1px solid #dee2e6}
    .progress-fill{height:100%;background:linear-gradient(to right,#00bfff,#007bff);display:flex;align-items:center;justify-content:flex-end;padding-right:10px;color:#fff;font-weight:bold;font-size:.9em;transition:width .4s ease-out;}

    /* ---------- FORMULARIOS / BOTONES ---------- */
    form{display:flex;flex-wrap:wrap;gap:10px;margin-top:15px;align-items:end}
    label{font-weight:600;color:#555}
    input[type=text],input[type=email],input[type=date]{flex:1;min-width:150px;padding:10px 12px;border-radius:6px;border:1px solid #ccc;box-shadow:inset 0 1px 3px rgba(0,0,0,.05);transition:border-color .2s ease;}
    input:focus{border-color:var(--primary-light);outline:none}
    button{padding:10px 18px;border:none;border-radius:6px;background:var(--primary-light);color:#000;font-weight:600;font-size:15px;cursor:pointer;transition:background .2s ease,transform .1s ease;white-space:nowrap;}
    button:hover{background:#009acd;transform:translateY(-1px)}
    button:active{transform:translateY(0)}
    .user-management-actions button[name=toggle]{background:#ffc107;color:var(--text-dark)}
    .user-management-actions button[name=toggle]:hover{background:#e0a800}
    .user-management-actions button[name=regen_token]{background:#6c757d}
    .user-management-actions button[name=regen_token]:hover{background:#5a6268}

    /* ---------- FOOTER ---------- */
    footer{text-align:center;padding:32px;margin-top:50px;font-size:.9em;color:#777;background:var(--bg-white)}
    footer a{color:var(--primary-light);font-weight:600}
  </style>
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header>
    <img src="{{ url_for('static', filename='logo-alfasigma.png') }}" alt="Alfasigma">
    <h1>üìä Panel de RH ‚Äì Evaluaci√≥n de Sesiones</h1>
  </header>

  <div class="container">
    <!-- ... resto del contenido (sesiones, res√∫menes) se mantiene igual ... -->

    <!-- ===== GESTI√ìN DE USUARIOS ===== -->
    <h2 class="section-title">üîê Gesti√≥n de Usuarios</h2>
    <div class="users-section">
      <h3>Crear nuevo usuario (si no existe) / Ingresar a Dashboard (si ya est√° creado)</h3>
      <form id="userForm" onsubmit="return handleAdminSubmit(event)">
        <label for="new_user_name">Nombre:</label>
        <input type="text" id="new_user_name" name="name" placeholder="Nombre" required>

        <label for="new_user_email">Correo electr√≥nico:</label>
        <input type="email" id="new_user_email" name="email" placeholder="Correo electr√≥nico" required>

        <label for="new_user_token">Token:</label>
        <input type="text" id="new_user_token" name="token" placeholder="Token (d√©jalo vac√≠o para crear)">

        <button type="submit">Ingresar a Dashboard</button>
      </form>

      <table>
        <tr><th>Nombre</th><th>Email</th><th>Token</th><th>Rango de Fechas</th><th>Activo</th><th>Acciones</th></tr>
        {% for user in users %}
          <tr>
            <td>{{ user[1] }}</td>
            <td>{{ user[2] }}</td>
            <td>{{ user[6] }}</td>
            <td>{{ user[3] }} - {{ user[4] }}</td>
            <td>{{ 'S√≠' if user[5] else 'No' }}</td>
            <td>
              <form class="user-management-actions" action="/admin" method="POST">
                <input type="hidden" name="user_id" value="{{ user[0] }}">
                <button type="submit" name="action" value="toggle">{{ 'Desactivar' if user[5] else 'Activar' }}</button>
                <button type="submit" name="action" value="regen_token">Nuevo Token</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>

  <script>
async function handleAdminSubmit(e){
  e.preventDefault();
  const f      = e.target;
  const name   = f.elements.name.value.trim();
  const email  = f.elements.email.value.trim();
  const token  = f.elements.token.value.trim();

  /* crear usuario */
  if(!token){
    const res = await fetch('/admin/users',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name,email})
    });
    if(res.ok){ window.location.reload(); }
    else{ alert('Error al crear usuario'); }
    return false;
  }

  /* abrir dashboard existente */
  window.open(
    `https://leo-api-ryzd.onrender.com/dashboard?auth=${encodeURIComponent(token)}`,
    '_blank'
  );
  return false;
}
  </script>

  <!-- ===== FOOTER ===== -->
  <footer>
    <p>Desarrollado por <a href="https://www.teams.com.mx" target="_blank">/Teams>/
